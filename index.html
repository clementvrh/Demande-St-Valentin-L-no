<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Valentine ğŸ’˜</title>

  <style>
    :root{
      --bg: #fff8fb;
      --text: #2b2b2b;
      --muted: #6b6b6b;
      --pink: #ff4d79;
      --pink2: #ff2f6b;
      --shadow: 0 12px 30px rgba(255, 77, 121, .22);
      --ease: cubic-bezier(.22,.61,.36,1);
    }

    * { box-sizing: border-box; }

    html, body { height: 100%; }
    body{
      margin:0;
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 50% 20%, #fff 0%, var(--bg) 55%, #ffe8f0 100%);
      color: var(--text);
      overflow: hidden;

      /* Cursor custom on desktop */
      cursor: none !important;
    }
    button, a, input, label, textarea, select{
      cursor: none !important; /* keep custom cursor even on click/hover */
    }

    /* Default cursor on touch devices */
    @media (hover: none) and (pointer: coarse){
      body{ cursor: auto !important; }
      #cursorDot{ display: none !important; }
      button, a, input, label, textarea, select{ cursor: auto !important; }
    }

    /* Custom cursor dot */
    #cursorDot{
      position: fixed;
      left: 0; top: 0;
      width: 10px; height: 10px;
      border-radius: 999px;
      background: radial-gradient(circle at 35% 35%, #ffd1df 0%, var(--pink) 45%, var(--pink2) 100%);
      box-shadow:
        0 0 16px rgba(255,47,107,.30),
        0 0 30px rgba(255,47,107,.16);
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 9999;
      opacity: 0;
      transition: opacity .15s ease;
      will-change: transform;
    }

    /* Background floating hearts */
    #bg{
      position: fixed;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
    }
    .bubble-heart{
      position: absolute;
      bottom: -60px;
      left: 0;
      font-size: 18px;
      opacity: .18;
      transform: translate3d(0,0,0);
      animation: floatUp linear forwards;
      will-change: transform, opacity;
      text-shadow: 0 10px 25px rgba(255, 77, 121, .22);
      filter: drop-shadow(0 10px 20px rgba(255,77,121,.16));
    }
    @keyframes floatUp{
      0%   { transform: translate3d(0, 0, 0) scale(1); opacity: 0; }
      10%  { opacity: var(--o, .22); }
      90%  { opacity: var(--o, .22); }
      100% { transform: translate3d(var(--dx, 0px), -120vh, 0) scale(var(--s, 1)); opacity: 0; }
    }

    /* Layout */
    .stage{
      position: relative;
      height: 100%;
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .card{
      width: min(900px, 94vw);
      border-radius: 22px;
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(10px);
      box-shadow: 0 20px 60px rgba(0,0,0,.07);
      border: 1px solid rgba(255,255,255,.55);
      position: relative;
      overflow: visible; /* allow final photos to overlap outside */
      min-height: 380px;
    }

    /* Screens: smooth fade */
    .screen{
      position: absolute;
      inset: 0;
      padding: 34px 18px;
      opacity: 0;
      transform: translateY(10px);
      pointer-events: none;
      transition: opacity .55s var(--ease), transform .55s var(--ease);
      text-align: center;
    }
    .screen.active{
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    /* Top hearts (screen 1) */
    .hearts-top{
      display:flex;
      gap: 10px;
      justify-content:center;
      align-items:center;
      margin-bottom: 8px;
      height: 52px;
    }
    .heart{
      width: 32px;
      height: 32px;
      position: relative;
      transform: rotate(-45deg);
      background: var(--pink);
      border-radius: 7px;
      animation: beat 1.2s ease-in-out infinite;
      filter:
        drop-shadow(0 12px 18px rgba(255,77,121,.22))
        drop-shadow(0 0 14px rgba(255,77,121,.22));
    }
    .heart::before,
    .heart::after{
      content:"";
      position:absolute;
      width: 32px;
      height: 32px;
      background: var(--pink);
      border-radius: 50%;
      filter: drop-shadow(0 0 12px rgba(255,77,121,.18));
    }
    .heart::before{ top:-16px; left:0; }
    .heart::after { left:16px; top:0; }

    .heart.small{
      width: 22px; height: 22px;
      opacity: .95;
      animation-duration: 1.35s;
    }
    .heart.small::before,
    .heart.small::after{
      width: 22px; height: 22px;
    }
    .heart.small::before{ top:-11px; }
    .heart.small::after{ left:11px; }

    @keyframes beat{
      0%, 100% { transform: rotate(-45deg) scale(1); }
      18% { transform: rotate(-45deg) scale(1.08); }
      36% { transform: rotate(-45deg) scale(0.98); }
      54% { transform: rotate(-45deg) scale(1.12); }
      72% { transform: rotate(-45deg) scale(1.00); }
    }

    h1{
      font-size: clamp(26px, 3.2vw, 40px);
      line-height: 1.15;
      margin: 10px 0 18px;
      letter-spacing: .2px;
    }
    .name{
      font-weight: 950;
      background: linear-gradient(90deg, var(--pink2), #ff7aa2);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      white-space: nowrap;
    }

    /* Buttons row: YES + NO centered together */
    .buttons{
      display:flex;
      gap: 12px;
      justify-content:center;
      align-items:center;
      margin-top: 18px;
      height: 58px;
    }

    button{
      border: 0;
      padding: 12px 18px;
      border-radius: 999px;
      font-weight: 950;
      font-size: 16px;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      white-space: nowrap;
      transition: transform .12s ease, box-shadow .22s ease, background .22s ease, opacity .22s ease;
    }

    #yesBtn{
      background: var(--pink);
      color: #fff;
      box-shadow: var(--shadow);
      min-width: 120px;
      position: relative;
    }
    #yesBtn:hover{ transform: translateY(-1px); }
    #yesBtn:active{ transform: translateY(1px) scale(.99); }

    /* NO button: starts in row, then roams (fixed) */
    #noBtn{
      background: rgba(255, 77, 121, .10);
      color: var(--pink2);
      border: 1px solid rgba(255, 77, 121, .25);
      min-width: 130px;
      box-shadow: 0 10px 24px rgba(0,0,0,.06);
      backdrop-filter: blur(8px);
    }
    #noBtn.fixedRoam{
      position: fixed;
      left: 50%;
      top: 62%;
      transform: translate(-50%, -50%);
      z-index: 50;
      transition:
        left .18s var(--ease),
        top  .18s var(--ease),
        opacity .25s ease,
        transform .12s ease;
    }

    /* Hint */
    .hint{
      margin-top: 12px;
      font-size: 13px;
      color: rgba(0,0,0,.40);
      font-weight: 850;
      min-height: 18px;
      opacity: 0;
      transform: translateY(4px);
      transition: opacity .35s ease, transform .35s ease;
    }
    .hint.show{
      opacity: 1;
      transform: translateY(0);
    }

    /* FX layer */
    #fx{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9998;
    }
    .popHeart{
      position: absolute;
      left: 0; top: 0;
      font-size: 18px;
      transform: translate(-50%, -50%);
      opacity: 0;
      animation: popFly 900ms var(--ease) forwards;
      filter: drop-shadow(0 10px 18px rgba(255,47,107,.22));
      will-change: transform, opacity;
    }
    @keyframes popFly{
      0%   { opacity: 0; transform: translate(-50%, -50%) scale(.6); }
      10%  { opacity: 1; }
      100% {
        opacity: 0;
        transform:
          translate(calc(-50% + var(--dx, 0px)), calc(-50% + var(--dy, -120px)))
          scale(var(--s, 1.25))
          rotate(var(--r, 10deg));
      }
    }

    /* LOADING SCREEN: photo above panel, panel contains only bar + text */
    .loadStage{
      position: relative;
      height: 100%;
      display: grid;
      place-items: center;
    }

    .loadPanel{
      width: min(560px, 86vw);
      border-radius: 18px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: 0 18px 50px rgba(0,0,0,.06);
      padding: 26px 18px 22px;
      margin-top: 85px; /* leaves room for photo above */
    }

    /* Photo ABOVE the panel, centered, no frame added */
    #loadPhoto{
      position: absolute;
      left: 50%;
      top: 0;
      transform: translate(-50%, -8px);
      width: min(520px, 82vw);
      height: auto;
      max-height: 260px;
      object-fit: contain;
      opacity: 1;
      transition: opacity .35s ease;
      filter: drop-shadow(0 14px 28px rgba(0,0,0,.12)); /* very light shadow */
      border-radius: 0; /* keep your polaroid style as-is */
    }
    #loadPhoto.fade{ opacity: 0; }

    .loaderHeart{
      width: 30px; height: 30px;
      transform: rotate(-45deg);
      background: var(--pink2);
      border-radius: 7px;
      filter: drop-shadow(0 12px 25px rgba(255,47,107,.18));
      animation: beat 1.15s ease-in-out infinite;
      position: relative;
      margin: 0 auto 10px;
    }
    .loaderHeart::before, .loaderHeart::after{
      content:"";
      position:absolute;
      width: 30px; height: 30px;
      background: var(--pink2);
      border-radius: 50%;
    }
    .loaderHeart::before{ top:-15px; left:0; }
    .loaderHeart::after { left:15px; top:0; }

    .bar{
      width: min(440px, 80vw);
      height: 10px;
      background: rgba(255, 77, 121, .15);
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid rgba(255, 77, 121, .18);
      margin: 8px auto 10px;
    }
    .bar > i{
      display:block;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--pink2), #ff7aa2);
      border-radius: 999px;
      transition: width .18s var(--ease);
    }
    .percent{
      font-weight: 950;
      color: var(--pink2);
      margin-bottom: 8px;
    }
    .loadingText{
      color: var(--muted);
      font-weight: 900;
      min-height: 22px;
      opacity: 1;
      transition: opacity .35s ease, transform .35s ease;
      transform: translateY(0);
    }
    .loadingText.fadeOut{
      opacity: 0;
      transform: translateY(6px);
    }

    /* FINAL: single-piece heart with 3D look via SVG */
    .finalText{
      display:flex;
      flex-direction: column;
      align-items:center;
      gap: 10px;
      max-width: 560px;
      margin: 0 auto;
      padding-top: 12px;
    }
    .finalHeartWrap{
      width: 88px;
      height: 88px;
      filter: drop-shadow(0 14px 30px rgba(255,47,107,.22));
      animation: finalBeat 1.25s ease-in-out infinite;
      position: relative;
    }
    @keyframes finalBeat{
      0%, 100% { transform: scale(1); }
      18% { transform: scale(1.06); }
      36% { transform: scale(.99); }
      54% { transform: scale(1.09); }
      72% { transform: scale(1.00); }
    }
    .subtitle{
      margin: 0;
      color: var(--muted);
      font-weight: 900;
    }
    .loveLine{
      margin: 0;
      font-weight: 950;
    }

    /* FINAL PHOTOS: overlap top-right corner slightly, second overlaps bottom-right of first */
    .finalPolaroids{
      position: absolute;
      right: -120px;
      top: 28px;
      width: 260px;
      pointer-events: none;
    }
    .finalPolaroids img{
      width: 260px;
      height: auto;
      display:block;
      border-radius: 0; /* keep your own frame */
      filter: drop-shadow(0 14px 28px rgba(0,0,0,.14)); /* subtle shadow only */
    }
    .finalPolaroid1{
      position: absolute;
      right: 0;
      top: -6px;     /* eats a bit into the card top-right */
      transform: rotate(6deg);
    }
    .finalPolaroid2{
      position: absolute;
      right: 6px;
      top: 220px;    /* overlaps lower-right of first */
      transform: rotate(-7deg);
    }

    /* On smaller screens: place photos below, not outside */
    @media (max-width: 980px){
      .finalPolaroids{
        position: static;
        width: auto;
        margin: 18px auto 0;
        display:flex;
        gap: 14px;
        justify-content:center;
        pointer-events: auto;
      }
      .finalPolaroids img{
        width: min(300px, 70vw);
        position: static;
        transform: none;
      }
      .finalPolaroid2{ top:auto; }
    }
  </style>
</head>

<body>
  <div id="bg" aria-hidden="true"></div>
  <div id="fx" aria-hidden="true"></div>
  <div id="cursorDot" aria-hidden="true"></div>

  <div class="stage">
    <div class="card">

      <!-- SCREEN 1 -->
      <section id="screenAsk" class="screen active">
        <div class="hearts-top">
          <div class="heart"></div>
          <div class="heart small"></div>
        </div>

        <h1>
          <span class="name">LÃ©nora Deparis Verhoeven</span>,<br/>
          veux-tu Ãªtre ma Valentine ?
        </h1>

        <div class="buttons" id="btnRow">
          <button id="yesBtn">Oui ! ğŸ’</button>
          <button id="noBtn">Non</button>
        </div>

        <div id="hint" class="hint"></div>
      </section>

      <!-- SCREEN 2 (LOADING) -->
      <section id="screenLoad" class="screen">
        <div class="loadStage">
          <img id="loadPhoto" src="assets/final1.png" alt="Nous - loading">

          <div class="loadPanel">
            <div class="loaderHeart"></div>
            <div class="bar"><i id="barFill"></i></div>
            <div class="percent"><span id="pct">0</span>%</div>
            <div class="loadingText" id="loadingText">RÃ©servation de la table au NÅªâ€¦ ğŸ½ï¸âœ¨</div>
          </div>
        </div>
      </section>

      <!-- SCREEN 3 (FINAL) -->
      <section id="screenDone" class="screen">
        <div class="finalText">
          <div class="finalHeartWrap" aria-hidden="true">
            <!-- Single-path heart SVG with 3D shading + glow -->
            <svg viewBox="0 0 120 120" width="88" height="88">
              <defs>
                <radialGradient id="gMain" cx="35%" cy="30%" r="75%">
                  <stop offset="0%" stop-color="#ffd1df"/>
                  <stop offset="35%" stop-color="#ff6b97"/>
                  <stop offset="70%" stop-color="#ff2f6b"/>
                  <stop offset="100%" stop-color="#d80f4b"/>
                </radialGradient>

                <!-- soft highlight -->
                <radialGradient id="gHi" cx="30%" cy="28%" r="55%">
                  <stop offset="0%" stop-color="rgba(255,255,255,.85)"/>
                  <stop offset="55%" stop-color="rgba(255,255,255,.12)"/>
                  <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
                </radialGradient>

                <!-- glow -->
                <filter id="fGlow" x="-50%" y="-50%" width="200%" height="200%">
                  <feGaussianBlur stdDeviation="6" result="blur"/>
                  <feColorMatrix in="blur" type="matrix"
                    values="1 0 0 0 0
                            0 0.2 0 0 0
                            0 0 0.3 0 0
                            0 0 0 0.35 0" result="pinkBlur"/>
                  <feMerge>
                    <feMergeNode in="pinkBlur"/>
                    <feMergeNode in="SourceGraphic"/>
                  </feMerge>
                </filter>

                <!-- subtle inner shadow for 3D -->
                <filter id="fInner" x="-50%" y="-50%" width="200%" height="200%">
                  <feOffset dx="0" dy="2"/>
                  <feGaussianBlur stdDeviation="3" result="offBlur"/>
                  <feComposite in="offBlur" in2="SourceAlpha" operator="arithmetic"
                               k2="-1" k3="1" result="innerShadow"/>
                  <feColorMatrix in="innerShadow" type="matrix"
                    values="0 0 0 0 0
                            0 0 0 0 0
                            0 0 0 0 0
                            0 0 0 .28 0"/>
                  <feComposite in2="SourceGraphic" operator="over"/>
                </filter>
              </defs>

              <!-- glow base -->
              <path filter="url(#fGlow)" d="M60 108
                C58 106, 20 80, 20 48
                C20 28, 34 18, 47 18
                C55 18, 60 23, 60 23
                C60 23, 65 18, 73 18
                C86 18, 100 28, 100 48
                C100 80, 62 106, 60 108 Z"
                fill="url(#gMain)"/>

              <!-- inner shading -->
              <path filter="url(#fInner)" d="M60 108
                C58 106, 20 80, 20 48
                C20 28, 34 18, 47 18
                C55 18, 60 23, 60 23
                C60 23, 65 18, 73 18
                C86 18, 100 28, 100 48
                C100 80, 62 106, 60 108 Z"
                fill="url(#gMain)"/>

              <!-- highlight -->
              <path d="M60 108
                C58 106, 20 80, 20 48
                C20 28, 34 18, 47 18
                C55 18, 60 23, 60 23
                C60 23, 65 18, 73 18
                C86 18, 100 28, 100 48
                C100 80, 62 106, 60 108 Z"
                fill="url(#gHi)" opacity="0.55"/>
            </svg>
          </div>

          <h1>Yeees&nbsp;!</h1>
          <p class="subtitle">Je savais que tu allais dire oui ğŸ’</p>
          <p class="loveLine">Je tâ€™aime ma LÃ©no â¤ï¸</p>
        </div>

        <!-- Overlapping polaroids -->
        <div class="finalPolaroids" aria-label="Polaroids">
          <img class="finalPolaroid1" src="assets/final9.png" alt="Nous - polaroid 1">
          <img class="finalPolaroid2" src="assets/final2.png" alt="Nous - polaroid 2">
        </div>
      </section>

    </div>
  </div>

  <script>
    // ========= Custom cursor (smooth follow) =========
    const cursorDot = document.getElementById('cursorDot');
    let curX = window.innerWidth / 2, curY = window.innerHeight / 2;
    let targetX = curX, targetY = curY;
    let cursorVisible = false;

    function cursorLoop(){
      curX += (targetX - curX) * 0.22;
      curY += (targetY - curY) * 0.22;
      cursorDot.style.transform = `translate(${curX}px, ${curY}px) translate(-50%, -50%)`;
      requestAnimationFrame(cursorLoop);
    }
    cursorLoop();

    window.addEventListener('mousemove', (e) => {
      targetX = e.clientX;
      targetY = e.clientY;
      if(!cursorVisible){
        cursorVisible = true;
        cursorDot.style.opacity = '1';
      }
    }, { passive:true });

    window.addEventListener('mouseleave', () => {
      cursorVisible = false;
      cursorDot.style.opacity = '0';
    });

    // ========= Background hearts =========
    const bg = document.getElementById('bg');
    const heartChars = ["â¤","ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’","ğŸ’•"];

    function spawnBubble(){
      const el = document.createElement('div');
      el.className = 'bubble-heart';
      el.textContent = heartChars[(Math.random()*heartChars.length)|0];

      const vw = window.innerWidth;
      const x = Math.random() * vw;
      const size = 14 + Math.random()*22;
      const drift = (Math.random()*2 - 1) * 120;
      const opacity = 0.12 + Math.random()*0.22;
      const duration = 7 + Math.random()*8;

      el.style.left = `${x}px`;
      el.style.fontSize = `${size}px`;
      el.style.setProperty('--dx', `${drift}px`);
      el.style.setProperty('--o', opacity.toFixed(2));
      el.style.setProperty('--s', (0.85 + Math.random()*0.6).toFixed(2));
      el.style.animationDuration = `${duration}s`;

      bg.appendChild(el);
      setTimeout(() => el.remove(), duration*1000 + 250);
    }
    setInterval(spawnBubble, 260);
    for(let i=0;i<10;i++) setTimeout(spawnBubble, i*80);

    // ========= Screens =========
    function showScreen(id){
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    // ========= No button logic =========
    const noBtn = document.getElementById('noBtn');
    const yesBtn = document.getElementById('yesBtn');
    const hintEl = document.getElementById('hint');

    const noFirst = [
      "Non",
      "Tâ€™es sÃ»re ?",
      "RÃ©flÃ©chis mieuxâ€¦",
      "Allez ğŸ˜‡",
      "Tu vas cliquer â€œOuiâ€ ğŸ˜Œ"
    ];

    const noRandomPool = [
      "On sait tous les deux que tu vas dire oui ğŸ˜Œ",
      "Le destin a dÃ©jÃ  choisi ğŸ’˜",
      "Le bouton â€˜Ouiâ€™ te regarde ğŸ‘€",
      "Attention moi aussi je sais bouderâ€¦",
      "Tu veux vraiment me briser le cÅ“ur ? ğŸ¥º",
      "Erreur 404 : â€˜Nonâ€™ introuvable",
      "Je refuse dâ€™exister sans ton oui ğŸ˜­",
      "Clique oui et je te fais un bisou",
      "Ce bouton est en RTT aujourdâ€™hui",
      "Tâ€™as glissÃ©â€¦ vers â€˜Ouiâ€™ ğŸ™‚",
      "Ã‡a sent le â€˜Ouiâ€™ Ã  plein nez",
      "On recommence : tu dis oui ? ğŸ˜‡",
      "Je suis programmÃ© pour fuir ğŸ˜",
      "Tu veux jouer ? Moi aussi ğŸ˜ˆ",
      "Je te laisse une chanceâ€¦ de cliquer Oui",
      "Câ€™est nonâ€¦ enfin câ€™est oui",
      "Je fais semblant dâ€™Ãªtre un choix",
      "Bonâ€¦ Ã§a suffit, clique Oui ma LÃ©no ğŸ˜˜",
      "DÃ©solÃ©, ce bouton nâ€™est pas lâ€™option aujourdâ€™hui ğŸ’…",
      "Le â€˜Nonâ€™ est en rupture de stock",
      "Le â€˜Ouiâ€™ est juste lÃ  ğŸ‘‰"
    ];

    // Hint changes every 2 interactions, locks on 6th change
    const hintSteps = [
      "PS : le bouton â€œNonâ€ est un peu timide ğŸ˜‡",
      "Indice : il aime bien se sauver au dernier moment ğŸ˜",
      "Tu peux essayerâ€¦ mais il est trÃ¨s sportif ğŸƒâ€â™€ï¸ğŸ’¨",
      "Je crois quâ€™il a peur de ton doigt ğŸ˜‚",
      "Plus tu insistesâ€¦ plus il panique ğŸ˜­",
      "Il faut cliquer sur oui ma LÃ©no... â¤ï¸"
    ];

    let noInteractions = 0;
    let lastRandomIdx = -1;
    let roamingEnabled = false;
    let lastMoveAt = 0;

    const COOLDOWN_MS = 280;
    const DODGE_RADIUS = 95;
    const PADDING = 10;

    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

    function setNoText(){
      if(noInteractions <= 5){
        noBtn.textContent = noFirst[noInteractions - 1];
        return;
      }
      let idx;
      do{
        idx = (Math.random() * noRandomPool.length) | 0;
      } while(noRandomPool.length > 1 && idx === lastRandomIdx);

      lastRandomIdx = idx;
      noBtn.textContent = noRandomPool[idx];
    }

    function updateHint(){
      if(noInteractions < 1) return;
      if(!hintEl.classList.contains('show')) hintEl.classList.add('show');
      const step = clamp(Math.floor((noInteractions - 1) / 2), 0, hintSteps.length - 1);
      hintEl.textContent = hintSteps[step];
    }

    function enableRoaming(){
      if(roamingEnabled) return;
      roamingEnabled = true;

      noBtn.classList.add('fixedRoam');

      const r = noBtn.getBoundingClientRect();
      const cx = (r.left + r.right)/2;
      const cy = (r.top + r.bottom)/2;

      // clamp immediately so it never starts off-screen
      const bw = r.width, bh = r.height;
      const x = clamp(cx, bw/2 + PADDING, window.innerWidth - bw/2 - PADDING);
      const y = clamp(cy, bh/2 + PADDING, window.innerHeight - bh/2 - PADDING);

      noBtn.style.left = `${x}px`;
      noBtn.style.top  = `${y}px`;
    }

    function moveNoButton(){
      const now = Date.now();
      if(now - lastMoveAt < COOLDOWN_MS) return;
      lastMoveAt = now;

      noInteractions++;
      setNoText();
      updateHint();
      if(noInteractions >= 1) enableRoaming();

      const r = noBtn.getBoundingClientRect();
      const bw = r.width, bh = r.height;

      const minX = bw/2 + PADDING;
      const maxX = window.innerWidth - bw/2 - PADDING;
      const minY = bh/2 + PADDING;
      const maxY = window.innerHeight - bh/2 - PADDING;

      // avoid being too close to YES
      const yesRect = yesBtn.getBoundingClientRect();
      const yesCx = (yesRect.left + yesRect.right)/2;
      const yesCy = (yesRect.top + yesRect.bottom)/2;

      let x, y, tries = 0;
      do{
        x = minX + Math.random() * (maxX - minX);
        y = minY + Math.random() * (maxY - minY);
        tries++;
      } while(Math.hypot(x - yesCx, y - yesCy) < 180 && tries < 30);

      x = clamp(x, minX, maxX);
      y = clamp(y, minY, maxY);

      noBtn.style.left = `${x}px`;
      noBtn.style.top  = `${y}px`;
    }

    function pointerNearNo(x, y){
      const r = noBtn.getBoundingClientRect();
      const cx = (r.left + r.right)/2;
      const cy = (r.top + r.bottom)/2;
      return Math.hypot(x - cx, y - cy) < DODGE_RADIUS;
    }

    window.addEventListener('mousemove', (e) => {
      if(!document.getElementById('screenAsk').classList.contains('active')) return;
      if(pointerNearNo(e.clientX, e.clientY)) moveNoButton();
    }, { passive:true });

    window.addEventListener('touchstart', (e) => {
      if(!document.getElementById('screenAsk').classList.contains('active')) return;
      const t = e.touches[0];
      if(t && pointerNearNo(t.clientX, t.clientY)) moveNoButton();
    }, { passive:true });

    noBtn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      if(document.getElementById('screenAsk').classList.contains('active')) moveNoButton();
    });

    // ========= Pop hearts FX on YES =========
    const fx = document.getElementById('fx');
    const popChars = ["ğŸ’˜","ğŸ’","ğŸ’–","ğŸ’•","â¤","ğŸ’—"];

    function spawnPopHeart(x, y){
      const el = document.createElement('div');
      el.className = 'popHeart';
      el.textContent = popChars[(Math.random()*popChars.length)|0];

      const dx = (Math.random()*2 - 1) * 140;
      const dy = -80 - Math.random()*180;
      const s  = 0.9 + Math.random()*0.9;
      const r  = (-18 + Math.random()*36) + "deg";

      el.style.left = x + "px";
      el.style.top  = y + "px";
      el.style.setProperty('--dx', dx + "px");
      el.style.setProperty('--dy', dy + "px");
      el.style.setProperty('--s', s.toFixed(2));
      el.style.setProperty('--r', r);
      el.style.fontSize = (16 + Math.random()*16) + "px";

      fx.appendChild(el);
      setTimeout(() => el.remove(), 950);
    }

    function popHeartsFromElement(el){
      const r = el.getBoundingClientRect();
      const x = (r.left + r.right)/2;
      const y = (r.top + r.bottom)/2;

      for(let i=0;i<14;i++) setTimeout(() => spawnPopHeart(x, y), i*12);
      for(let i=0;i<8;i++) setTimeout(() => spawnPopHeart(x + (Math.random()*40-20), y + (Math.random()*20-10)), 220 + i*40);
    }

    // ========= Loading =========
    const barFill = document.getElementById('barFill');
    const pct = document.getElementById('pct');
    const loadingText = document.getElementById('loadingText');
    const loadPhoto = document.getElementById('loadPhoto');

    const loadingPhrases = [
      "RÃ©servation de la table au NÅªâ€¦ ğŸ½ï¸âœ¨",
      "Chargement de lâ€™amour en coursâ€¦ ğŸ’˜",
      "PrÃ©paration des sentimentsâ€¦ ğŸ’",
      "Assemblage des bisousâ€¦ ğŸ˜˜",
      "Polissage de la bagueâ€¦ ğŸ’",
      "Ajout de cÃ¢lins illimitÃ©sâ€¦ ğŸ«¶",
      "Mon amourâ€¦ â¤ï¸"
    ];

    function easeInOutCubic(t){
      return t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t + 2, 3)/2;
    }

    function setLoadingPhrase(i){
      loadingText.classList.add('fadeOut');
      setTimeout(() => {
        loadingText.textContent = loadingPhrases[i];
        loadingText.classList.remove('fadeOut');
      }, 240);
    }

    const loadPhotos = [
      "assets/final1.png",
      "assets/final3.png",
      "assets/final4.png",
      "assets/final5.png",
      "assets/final6.png",
      "assets/final7.png",
      "assets/final8.png"
    ];

    function startSlideshow(totalMs){
      if(!loadPhoto || loadPhotos.length === 0) return null;
      let i = 0;
      loadPhoto.src = loadPhotos[0];

      const stepMs = Math.max(750, Math.floor(totalMs / Math.max(loadPhotos.length, 5)));

      const timer = setInterval(() => {
        i = (i + 1) % loadPhotos.length;
        loadPhoto.classList.add('fade');
        setTimeout(() => {
          loadPhoto.src = loadPhotos[i];
          loadPhoto.classList.remove('fade');
        }, 220);
      }, stepMs);

      return timer;
    }

    function runLoading(){
      // hide roaming no
      if(roamingEnabled){
        noBtn.style.opacity = '0';
        noBtn.style.pointerEvents = 'none';
      }

      showScreen('screenLoad');

      const totalMs = 5800;
      const slideTimer = startSlideshow(totalMs);

      const start = performance.now();
      let phraseIndex = 0;
      loadingText.textContent = loadingPhrases[0];

      const phraseTimer = setInterval(() => {
        phraseIndex = Math.min(phraseIndex + 1, loadingPhrases.length - 1);
        setLoadingPhrase(phraseIndex);
      }, 950);

      function tick(now){
        const raw = clamp((now - start) / totalMs, 0, 1);
        const eased = easeInOutCubic(raw);

        const p = Math.round(eased * 100);
        pct.textContent = p;
        barFill.style.width = `${p}%`;

        if(raw < 1){
          requestAnimationFrame(tick);
        } else {
          clearInterval(phraseTimer);
          if(slideTimer) clearInterval(slideTimer);
          setTimeout(() => showScreen('screenDone'), 420);
        }
      }
      requestAnimationFrame(tick);
    }

    yesBtn.addEventListener('click', () => {
      popHeartsFromElement(yesBtn);
      setTimeout(runLoading, 420);
    });
  </script>
</body>
</html>
